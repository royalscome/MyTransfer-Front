"use strict";const{app:n,BrowserWindow:l,protocol:a,ipcMain:s}=require("electron"),{join:i,resolve:p,dirname:f}=require("path");require("child_process");require("fs");a.registerSchemesAsPrivileged([{scheme:"app",privileges:{secure:!0,standard:!0}}]);process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";process.env.NODE_ENV===void 0&&(process.defaultApp?process.env.NODE_ENV="development":process.env.NODE_ENV="production");const c=process.env.NODE_ENV!=="production";let d,u="";global.sharedObject={url:u,name:"局域网文件互传系统",version:"1.0.0",exePath:d,environment:c?"development":"production",homePath:n.getPath("home")};s.on("get-shared-object",e=>{e.returnValue=global.sharedObject});const r=async()=>{const e=new l({icon:i(__dirname,"resource/favicon.ico"),title:"局域网文件互传",width:1024,height:768,show:!1,resizable:!1,maximizable:!1,webPreferences:{webSecurity:!1,enableRemoteModule:!0,nodeIntegration:!0,contextIsolation:!1,webviewTag:!0}});e.on("ready-to-show",()=>{e.show()});let t=!1;e.on("close",o=>{t||(o.preventDefault(),e.webContents.send("confirm-close"))}),s.on("can-close",()=>{t||(t=!0,e.close())}),e.on("closed",()=>{n.quit()}),s.on("check-online-status",o=>{o.returnValue=navigator.onLine}),n.on("online",()=>{console.log("Online"),e.webContents.send("online-status-changed",!0)}),n.on("offline",()=>{console.log("Offline"),e.webContents.send("online-status-changed",!1)}),process.env.VITE_DEV_SERVER_URL?(await e.loadURL(process.env.VITE_DEV_SERVER_URL).catch(o=>{console.error("Failed to load URL:",o)}),process.env.IS_TEST||e.webContents.openDevTools()):e.loadFile(i(__dirname,"dist/index.html"))};n.whenReady().then(()=>{r(),n.on("activate",()=>{l.getAllWindows().length===0&&r()})});n.on("window-all-closed",()=>{process.platform!=="darwin"&&n.quit()});
