"use strict";const{app:o,BrowserWindow:a,protocol:l,ipcMain:t,dialog:c}=require("electron"),{join:i,resolve:f,dirname:h}=require("path");require("child_process");require("fs");l.registerSchemesAsPrivileged([{scheme:"app",privileges:{secure:!0,standard:!0}}]);process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";process.env.NODE_ENV===void 0&&(process.defaultApp?process.env.NODE_ENV="development":process.env.NODE_ENV="production");const d=process.env.NODE_ENV!=="production";let u,p="";global.sharedObject={url:p,name:"局域网文件互传系统",version:"1.0.0",exePath:u,environment:d?"development":"production",homePath:o.getPath("home")};t.on("get-shared-object",e=>{e.returnValue=global.sharedObject});const r=async()=>{const e=new a({icon:i(__dirname,"resource/favicon.ico"),title:"局域网文件互传",width:1024,height:768,show:!1,resizable:!1,maximizable:!1,webPreferences:{webSecurity:!1,enableRemoteModule:!0,nodeIntegration:!0,contextIsolation:!1,webviewTag:!0}});e.on("ready-to-show",()=>{e.show()});let s=!1;e.on("close",n=>{s||(n.preventDefault(),e.webContents.send("confirm-close"))}),t.on("can-close",()=>{s||(s=!0,e.close())}),e.on("closed",()=>{o.quit()}),t.on("check-online-status",n=>{n.returnValue=navigator.onLine}),o.on("online",()=>{console.log("Online"),e.webContents.send("online-status-changed",!0)}),o.on("offline",()=>{console.log("Offline"),e.webContents.send("online-status-changed",!1)}),process.env.VITE_DEV_SERVER_URL?(await e.loadURL(process.env.VITE_DEV_SERVER_URL).catch(n=>{console.error("Failed to load URL:",n)}),process.env.IS_TEST||e.webContents.openDevTools()):e.loadFile(i(__dirname,"dist/index.html"))};o.whenReady().then(()=>{r(),o.on("activate",()=>{a.getAllWindows().length===0&&r()})});o.on("window-all-closed",()=>{process.platform!=="darwin"&&o.quit()});t.handle("open-directory-dialog",async e=>await c.showOpenDialog({properties:["openDirectory"]}));
